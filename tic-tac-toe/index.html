<html>

<head>
    <title>Tic-Tac-Toe</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
		body{
			margin-top:30px;
		}

		#messageArea {
			display:none;
		}

        #userController {
			display:none;
        }

        table#tic-tac-toe-grid{
            width:100%;
            height:60%;
            border: 1px solid black;
            padding:20px;
        }
        #tic-tac-toe-grid td{
            padding:20px;
            border: 1px solid black;
            background-color:blanchedalmond;
        }
	</style>
</head>


<body>
<div class="container">
    <div id="userFormArea" class="row">
        <div class="col-md-12">
            <form id="userForm">
                <div class = "form-group">
                    <label> Enter Username</label>
                    <textarea class="form-control" id="username"> </textarea>
                    <br />
                    <input type="submit" class="btn btn-primary" value="login"></input>
                </div>
            </form>
        </div>
    </div>
    <div id="messageArea" class="row">
        <div class="col-md-4">
            <div class="well">
                <h3>Online Users</h3>
                <ul class="list-group" id="users"> </ul>
            </div>
        </div>
    </div>
    <div id="userController" class="row">
        <div class="col-md-12">
            <h2 id="playerTurnDisplay"></h2>

            <div class="row">
                <div class="col-md-6">
                    <p id="player1Name">player 1 score:</p>
                    <p id="player1Score">0</p>
                </div>
                <div class="col-md-6">
                    <p id="player2Name">player 2 score:</p>
                    <p id="player2Score">0</p>
                </div>
            </div>

            <div class="row">
                <div class="col-md-9">
                    <table id="tic-tac-toe-grid"> 
                        <tr>
                            <td id="1"></td>
                            <td id="2"></td>
                            <td id="3"></td>
                        </tr>
                        <tr>
                            <td id="4"></td>
                            <td id="5"></td>
                            <td id="6"></td>
                        </tr>
                        <tr>
                            <td id="7"></td>
                            <td id="8"></td>
                            <td id="9"></td>
                        </tr>                    
                        </table>
                </div>
            </div>

        </div>

    </div>
</div>

<script>
    	// main function
	$( function () {
		var socket 	           = io.connect();
		var $playerTurnDisplay = $('#playerTurnDisplay');
        var $grid              = $('table#tic-tac-toe-grid td');

        $grid.on( "mouseover", function() {
            $( this ).css( "background-color", "red" );

            $( this ).on("mouseout", function() {
                $( this ).css( "background-color", "blanchedalmond" );
            });

            $( this ).on("click", function() {
                $( this ).css("background-color", "blue");
                    socket.emit("grid marked", this.id);

            });
        });

		socket.on('player turn', function (username) {
			$playerTurnDisplay.append('<div class="well"><strong>'+username+' </strong> \'s turn to go!</div>');
		});

        socket.on('player left', function () {
			$playerTurnDisplay.html('');
		});

		var $messageArea     = $('#messageArea');
        var $userController  = $('#userController');
		var $userForm        = $('#userForm');
		var $userFormArea    = $('#userFormArea');
		var $username        = $('#username');
		var $users           = $('#users');

		$userForm.submit( function (e) {
			e.preventDefault();
			socket.emit('new user', $username.val(), function (data) {
				if (data) {
					$userFormArea.hide();
					$messageArea.show();
                    $userController.show();
				}
			});
			$username.val('');
		});

		socket.on('get users', function (data) {
			var html = '';
			for (i = 0; i < data.length; i++) {
				html += '<li class="list-group-item">'+data[i]+'</li>';
			}

			$users.html(html);
		});

		socket.on('remove user', function (name) {
		    var listGroup = document.getElementsByClassName("list-group-item");
            for (var i = 0; i < listGroup.length; i++) {
                if (listGroup[i].innerHTML === name) {
                    alert(name + " has left the game.  Please wait for next game to load...");
                    listGroup[i].parentElement.removeChild(listGroup[i]);
                }
            }
		});
	});
</script>

</body>
</html>
