<html>

<head>
    <title>Tic-Tac-Toe</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
		body{
			margin-top:30px;
		}

		#messageArea {
			display:none;
		}
	</style>
</head>


<body>
<div class="container">
    <div id="userFormArea" class="row">
        <div class="col-md-12">
            <form id="userForm">
                <div class = "form-group">
                    <label> Enter Username</label>
                    <textarea class="form-control" id="username"> </textarea>
                    <br />
                    <input type="submit" class="btn btn-primary" value="login"></input>
                </div>
            </form>
        </div>
    </div>
    <div id="messageArea" class="row">
        <div class="col-md-4">
            <div class="well">
                <h3>Online Users</h3>
                <ul class="list-group" id="users"> </ul>
            </div>
        </div>
    </div>
    <div id="userController" class="row">
        <div class="col-md-12">
            <h2 id="playerTurnDisplay"></h2>

            <div class="row">
                <div class="col-md-6">
                    <p>player 1 score:</p>
                    <p id="player1Score">0</p>
                </div>
                <div class="col-md-6">
                    <p>player 2 score:</p>
                    <p id="player2Score">0</p>
                </div>
            </div>

        </div>

    </div>
</div>

<script>
    	// main function
	$( function () {
		var socket 	           = io.connect();
		var $playerTurnDisplay = $('#playerTurnDisplay');

	    // 3. Recieve Message Broadcast
		socket.on('player-turn', function (data) {
			$playerTurnDisplay.append('<div class="well"><strong>'+data.userTurn+': </strong></div>');
		});

		var $messageArea     = $('#messageArea');
		var $userForm        = $('#userForm');
		var $userFormArea    = $('#userFormArea');
		var $username        = $('#username');
		var $users           = $('#users');

		$userForm.submit( function (e) {
			e.preventDefault();
			socket.emit('new user', $username.val(), function (data) {
				if (data) {
					$userFormArea.hide();
					$messageArea.show();
				}
			});
			$username.val('');
		});

		socket.on('get users', function (data) {
			var html = '';
			for (i = 0; i < data.length; i++) {
				html += '<li class="list-group-item">'+data[i]+'</li>';
			}

			$users.html(html);
		});

		socket.on('remove user', function (name) {
		    var listGroup = document.getElementsByClassName("list-group-item");
            for (var i = 0; i < listGroup.length; i++) {
                if (listGroup[i].innerHTML === name) {
                    alert(name + " has left the game.  Please wait for next game to load...");
                    listGroup[i].parentElement.removeChild(listGroup[i]);
                }
            }
		});
	});
</script>

</body>
</html>
